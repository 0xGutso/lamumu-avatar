<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lamumu Avatar Builder üêÑ</title>
  <meta name="description" content="Create your Lamumu cow avatar in the browser. Randomize, export PNG/SVG, and share on X with #Lamumu.">
  <meta property="og:title" content="Lamumu Avatar Builder üêÑ">
  <meta property="og:description" content="Compose layers, personalize, export, and share.">
  <meta name="theme-color" content="#151515">
  <style>
    :root{
      --bg:#0f1115;--panel:#161a23;--muted:#8892a6;--text:#e6edf6;--accent:#89d185;--line:#232838;
      --btn:#1f2533;--btn-h:#262d40;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 800px at 70% -20%, #1b2233 0%, var(--bg) 45%);
      color:var(--text);font:15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .app{width:100%;max-width:1100px;display:grid;grid-template-columns: 1.2fr .8fr;gap:16px}
    @media(max-width:940px){.app{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 30%),var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35);}
    .stage{position:relative;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:16px;overflow:hidden}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:12px;border-top:1px solid var(--line);background:#131825}
    button,.select{appearance:none;border:1px solid var(--line);background:var(--btn);color:var(--text);padding:10px 12px;border-radius:10px;cursor:pointer}
    button:hover{background:var(--btn-h)}
    .select{display:flex;align-items:center;gap:8px}
    .select label{font-size:12px;color:var(--muted)}
    select{appearance:none;border:none;background:transparent;color:var(--text);font:inherit;padding:0 4px 0 0;min-width:130px;cursor:pointer}
    .side{padding:16px}
    h1{margin:0 0 6px;font-size:22px}
    .muted{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 0}
    .footer{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    .chip{font-size:12px;color:var(--muted)}
    .badge{display:inline-block;padding:3px 8px;border:1px dashed var(--line);border-radius:999px;color:var(--muted);font-size:12px}
    .credit{padding:10px 14px;border-top:1px dashed var(--line);color:var(--muted);font-size:12px}
    .switch{margin-left:auto;display:flex;align-items:center;gap:8px}
    .switch input{accent-color:var(--accent);width:36px;height:18px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .idtag{font-weight:700;color:#c0e5b9}
    .tiny{font-size:12px;color:var(--muted)}
    .stage-inner{width:90%;max-width:680px;aspect-ratio:1/1;border-radius:12px;overflow:hidden;border:1px solid var(--line);background:#0b0f19}
    canvas{display:block;width:100%;height:100%}
  </style>
</head>
<body>
  <div class="app">
    <!-- CANVAS / RENDER -->
    <div class="card">
      <div class="stage">
        <div class="stage-inner">
          <canvas id="canvas" width="1024" height="1024"></canvas>
        </div>
      </div>
      <div class="toolbar">
        <div class="select"><label>Background</label>
          <select id="bg"></select>
        </div>
        <div class="select"><label>Body</label>
          <select id="body"></select>
        </div>
        <div class="select"><label>Eyes</label>
          <select id="eyes"></select>
        </div>
        <div class="select"><label>Mouth</label>
          <select id="mouth"></select>
        </div>
        <div class="select"><label>Accessory</label>
          <select id="acc"></select>
        </div>
        <span class="switch">
          <label class="tiny">Grid</label><input id="gridToggle" type="checkbox">
        </span>
        <span class="switch">
          <label class="tiny">Lamumu badge</label><input id="brandToggle" type="checkbox" checked>
        </span>
      </div>
    </div>

    <!-- CONTROLS -->
    <div class="card side">
      <h1>Lamumu Avatar <span class="badge">MVP</span></h1>
      <p class="muted">Pick your combo, then save or share it on X. Your ID: <span class="idtag" id="mooId">#LAMU-0001</span></p>

      <div class="grid">
        <div>
          <div class="actions">
            <button id="random">üé≤ Random</button>
            <button id="shuffleBody">üé® Body</button>
            <button id="shuffleEyes">üëÄ Eyes</button>
            <button id="shuffleMouth">üëÑ Mouth</button>
            <button id="shuffleAcc">‚ú® Accessory</button>
          </div>
        </div>
        <div>
          <div class="actions">
            <button id="savePng">‚¨áÔ∏è PNG</button>
            <button id="saveSvg">‚¨áÔ∏è SVG</button>
            <button id="share">üí¨ Share</button>
          </div>
        </div>
      </div>

      <div class="row">
        <span class="chip">1024√ó1024 ‚Ä¢ Non-transparent background</span>
        <span class="chip">Client-side only</span>
      </div>

      <div class="footer">
        <button id="copySeed">üîë Copy seed</button>
        <button id="applySeed">üîÑ Apply seed</button>
        <input id="seedInput" class="select" placeholder="Paste seed" style="flex:1;min-width:200px;background:transparent;border:1px dashed var(--line);padding:10px;border-radius:10px;color:var(--text)">
      </div>

      <div class="credit">
        Built by <strong>Gutso</strong> ‚Ä¢ Ready: PNG/SVG export, X share, seed.<br>
        <span class="tiny">Tip: Mention the official account and use <strong>#Lamumu</strong> for discovery.</span>
      </div>
    </div>
  </div>

  <script>
    // ---------- UTIL ----------
    const $ = sel => document.querySelector(sel);
    const fmt = n => String(n).padStart(4,'0');
    const rng = (seed) => { // Mulberry32
      let t = seed>>>0;
      return ()=>{ t+=0x6D2B79F5; let r = Math.imul(t ^ t>>>15,1|t); r ^= r + Math.imul(r ^ r>>>7, 61|r); return ((r ^ r>>>14)>>>0)/4294967296; }
    };
    const choice = (rnd, arr)=>arr[Math.floor(rnd()*arr.length)];

    // ---------- DRAW SETUP ----------
    const size = 1024, cx = size/2, cy = size/2;

    // Palettes
    const palettes = {
      baseWhite:{base:'#fff7ef',spot:'#2b2b2b',nose:'#e0b7a0'},
      holstein:{base:'#fff7ef',spot:'#1c1c1c',nose:'#d9a28d'},
      cocoa:{base:'#7b4b2e',spot:'#2c1b12',nose:'#d1a489'},
      night:{base:'#22252f',spot:'#6e7ea6',nose:'#9fb4ff'},
      nebula:{base:'#e7e4ff',spot:'#7a5cff',nose:'#ff9bd7'}
    };

    // Backgrounds
    const bgs = [
      {id:'plain', name:'Dark solid', draw:(ctx)=>{ctx.fillStyle='#0b0f19';ctx.fillRect(0,0,size,size);}},
      {id:'cream', name:'Cream gradient', draw:(ctx)=>{let g=ctx.createLinearGradient(0,0,size,size);g.addColorStop(0,'#fff1d8');g.addColorStop(1,'#ffe4f3');ctx.fillStyle=g;ctx.fillRect(0,0,size,size);}},
      {id:'space', name:'Space', draw:(ctx)=>{ctx.fillStyle='#0b0f19';ctx.fillRect(0,0,size,size);for(let i=0;i<300;i++){ctx.fillStyle=`rgba(255,255,255,${Math.random()})`;ctx.fillRect(Math.random()*size,Math.random()*size,2,2);}let rg=ctx.createRadialGradient(cx,cy,50,cx,cy,520);rg.addColorStop(0,'rgba(255,80,120,.15)');rg.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=rg;ctx.beginPath();ctx.arc(cx,cy,520,0,Math.PI*2);ctx.fill();}},
      {id:'pastel', name:'Pastel', draw:(ctx)=>{let g=ctx.createRadialGradient(200,200,0,800,820,900);g.addColorStop(0,'#c3f5ff');g.addColorStop(1,'#ffd1f6');ctx.fillStyle=g;ctx.fillRect(0,0,size,size);}},
      {id:'grid', name:'Grid', draw:(ctx)=>{ctx.fillStyle='#0e1220';ctx.fillRect(0,0,size,size);ctx.strokeStyle='rgba(255,255,255,.06)';ctx.lineWidth=1;for(let i=0;i<=size;i+=64){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,size);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(size,i);ctx.stroke();}}
      },
    ];

    // Bodies (palette-based)
    const bodyPalettes = [
      {id:'white', name:'White', pal:palettes.baseWhite},
      {id:'holstein', name:'Holstein', pal:palettes.holstein},
      {id:'cocoa', name:'Cocoa', pal:palettes.cocoa},
      {id:'night', name:'Night', pal:palettes.night},
      {id:'nebula', name:'Nebula', pal:palettes.nebula},
    ];

    function drawBody(ctx, pal, rnd){
      // head
      ctx.fillStyle = pal.base;
      ctx.beginPath();
      ctx.ellipse(cx, cy+40, 260, 220, 0, 0, Math.PI*2);
      ctx.fill();

      // ears
      ctx.beginPath(); ctx.ellipse(cx-220, cy-40, 70, 110, -0.2, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(cx+220, cy-40, 70, 110, 0.2, 0, Math.PI*2); ctx.fill();

      // horns
      ctx.fillStyle = '#f0e2c1';
      ctx.beginPath(); ctx.moveTo(cx-140, cy-160); ctx.quadraticCurveTo(cx-180,cy-260,cx-110,cy-220); ctx.quadraticCurveTo(cx-100,cy-190,cx-140,cy-160); ctx.fill();
      ctx.beginPath(); ctx.moveTo(cx+140, cy-160); ctx.quadraticCurveTo(cx+180,cy-260,cx+110,cy-220); ctx.quadraticCurveTo(cx+100,cy-190,cx+140,cy-160); ctx.fill();

      // random spots
      ctx.fillStyle = pal.spot;
      const n = 5 + Math.floor(rnd()*5);
      for(let i=0;i<n;i++){
        let x = cx + (rnd()*420-210);
        let y = cy + (rnd()*260-130);
        let rx = 30 + rnd()*90, ry = 25 + rnd()*80;
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate((rnd()-.5)*1.2);
        ctx.beginPath();
        ctx.ellipse(0,0,rx,ry,0,0,Math.PI*2);
        ctx.globalAlpha = 0.9;
        ctx.fill();
        ctx.restore();
      }

      // muzzle
      ctx.globalAlpha=1; ctx.fillStyle=pal.nose;
      ctx.beginPath();
      ctx.ellipse(cx, cy+150, 180, 100, 0, 0, Math.PI*2);
      ctx.fill();
      // nostrils
      ctx.fillStyle='rgba(0,0,0,.25)';
      ctx.beginPath(); ctx.ellipse(cx-45, cy+150, 16, 28, 0, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(cx+45, cy+150, 16, 28, 0, 0, Math.PI*2); ctx.fill();
    }

    // Eyes
    const eyesList = [
      {id:'normal', name:'Normal', draw:(ctx, pal)=>{
        ctx.fillStyle='#222';
        ctx.beginPath(); ctx.ellipse(cx-90, cy-30, 50, 36, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(cx+90, cy-30, 50, 36, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#fff';
        ctx.beginPath(); ctx.ellipse(cx-90, cy-30, 36, 26, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(cx+90, cy-30, 36, 26, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#111';
        ctx.beginPath(); ctx.arc(cx-80, cy-30, 10, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(cx+100, cy-28, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(cx-76, cy-34, 3, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(cx+104, cy-32, 3, 0, Math.PI*2); ctx.fill();
      }},
      {id:'sleepy', name:'Sleepy', draw:(ctx)=>{
        ctx.strokeStyle='#111'; ctx.lineWidth=6; ctx.lineCap='round';
        ctx.beginPath(); ctx.moveTo(cx-120,cy-20); ctx.quadraticCurveTo(cx-90,cy-40,cx-60,cy-20); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx+60,cy-20); ctx.quadraticCurveTo(cx+90,cy-40,cx+120,cy-20); ctx.stroke();
      }},
      {id:'laser', name:'Laser', draw:(ctx)=>{
        ctx.fillStyle='#fff'; ctx.beginPath(); ctx.ellipse(cx-90, cy-30, 28, 22, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(cx+90, cy-30, 28, 22, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#ff0040'; ctx.beginPath(); ctx.arc(cx-90, cy-30, 7, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(cx+90, cy-30, 7, 0, Math.PI*2); ctx.fill();
        const g=ctx.createLinearGradient(cx-90,cy-30, 0, size);
        g.addColorStop(0,'rgba(255,0,64,.9)'); g.addColorStop(1,'rgba(255,0,64,0)');
        ctx.fillStyle=g; ctx.globalAlpha=.7;
        ctx.fillRect(0, cy-20, size, 8);
        ctx.globalAlpha=1;
      }},
      {id:'stars', name:'Stars', draw:(ctx)=>{
        ctx.fillStyle='#fff'; for(const dx of [-90,90]){ctx.beginPath();ctx.ellipse(cx+dx,cy-30,30,24,0,0,Math.PI*2);ctx.fill()}
        ctx.strokeStyle='#ffd400'; ctx.lineWidth=2;
        for(const [ox,oy] of [[-90,-30],[90,-30]]){
          ctx.save(); ctx.translate(cx+ox,cy+oy);
          for(let i=0;i<5;i++){ctx.beginPath();ctx.moveTo(0,-10);ctx.lineTo(0,10);ctx.stroke();ctx.rotate(Math.PI/5);}
          ctx.restore();
        }
      }},
      {id:'sunglasses', name:'Sunglasses', draw:(ctx)=>{
        ctx.fillStyle='#0e0e0e'; 
        ctx.beginPath(); ctx.ellipse(cx-90, cy-30, 54, 38, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(cx+90, cy-30, 54, 38, 0, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle='#333'; ctx.lineWidth=6; ctx.beginPath(); ctx.moveTo(cx-36,cy-28); ctx.lineTo(cx+36,cy-28); ctx.stroke();
      }},
      {id:'hearts', name:'Hearts', draw:(ctx)=>{
        ctx.fillStyle='#ff4d6d';
        function heart(x,y,s){ctx.save();ctx.translate(x,y);ctx.scale(s,s);ctx.beginPath();ctx.moveTo(0,-10);ctx.bezierCurveTo(12,-24,30,-6,0,20);ctx.bezierCurveTo(-30,-6,-12,-24,0,-10);ctx.fill();ctx.restore();}
        heart(cx-90,cy-30,1.1); heart(cx+90,cy-30,1.1);
      }},
    ];

    // Mouths
    const mouths = [
      {id:'smile', name:'Smile', draw:(ctx)=>{
        ctx.strokeStyle='#3a1a10'; ctx.lineWidth=7; ctx.lineCap='round';
        ctx.beginPath(); ctx.arc(cx, cy+130, 46, 0, Math.PI); ctx.stroke();
      }},
      {id:'tongue', name:'Tongue out', draw:(ctx)=>{
        ctx.strokeStyle='#3a1a10'; ctx.lineWidth=7; ctx.lineCap='round';
        ctx.beginPath(); ctx.moveTo(cx-40,cy+135); ctx.quadraticCurveTo(cx,cy+165,cx+40,cy+135); ctx.stroke();
        ctx.fillStyle='#ff6b9a'; ctx.beginPath(); ctx.ellipse(cx, cy+150, 22, 16, 0, 0, Math.PI*2); ctx.fill();
      }},
      {id:'open', name:'Open mouth', draw:(ctx)=>{
        ctx.fillStyle='#2a1710'; ctx.beginPath(); ctx.ellipse(cx, cy+140, 32, 26, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#ffb3c1'; ctx.beginPath(); ctx.ellipse(cx, cy+152, 18, 12, 0, 0, Math.PI*2); ctx.fill();
      }},
      {id:'vibe', name:'Vibe', draw:(ctx)=>{
        ctx.strokeStyle='#3a1a10'; ctx.lineWidth=8; ctx.lineCap='round';
        ctx.beginPath(); ctx.moveTo(cx-50,cy+130); ctx.lineTo(cx-10,cy+145); ctx.lineTo(cx+30,cy+125); ctx.lineTo(cx+50,cy+135); ctx.stroke();
      }},
      {id:'whistle', name:'Whistle', draw:(ctx)=>{
        ctx.strokeStyle='#3a1a10'; ctx.lineWidth=7; ctx.lineCap='round';
        ctx.beginPath(); ctx.arc(cx, cy+140, 18, Math.PI*.1, Math.PI*.9); ctx.stroke();
      }},
    ];

    // Accessories
    const accs = [
      {id:'none', name:'None', draw:()=>{}},
      {id:'cap', name:'Cap', draw:(ctx)=>{
        ctx.fillStyle='#2b6cf0'; ctx.beginPath(); ctx.ellipse(cx, cy-170, 160, 70, 0.02, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#244db3'; ctx.beginPath(); ctx.ellipse(cx+60, cy-140, 120, 34, 0.02, 0, Math.PI*2); ctx.fill();
      }},
      {id:'crown', name:'Crown', draw:(ctx)=>{
        ctx.fillStyle='#ffd400';
        ctx.beginPath(); ctx.moveTo(cx-120,cy-210); ctx.lineTo(cx-70,cy-270); ctx.lineTo(cx-20,cy-210); ctx.lineTo(cx+30,cy-270); ctx.lineTo(cx+80,cy-210); ctx.lineTo(cx+120,cy-210); ctx.lineTo(cx+120,cy-190); ctx.lineTo(cx-120,cy-190); ctx.closePath(); ctx.fill();
        ctx.fillStyle='#ff7ac3'; for(let x=cx-80;x<=cx+80;x+=40){ctx.beginPath();ctx.arc(x,cy-230,8,0,Math.PI*2);ctx.fill();}
      }},
      {id:'ring', name:'Earrings', draw:(ctx)=>{
        ctx.strokeStyle='#ffd400'; ctx.lineWidth=8; ctx.beginPath(); ctx.arc(cx-220, cy+10, 18, Math.PI*.1, Math.PI*1.9); ctx.stroke();
        ctx.beginPath(); ctx.arc(cx+220, cy+10, 18, Math.PI*.1, Math.PI*1.9); ctx.stroke();
      }},
      {id:'bell', name:'Bell', draw:(ctx)=>{
        ctx.fillStyle='#ffcf33'; ctx.beginPath(); ctx.ellipse(cx, cy+220, 36, 30, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle='#c08a00'; ctx.beginPath(); ctx.arc(cx, cy+236, 10, 0, Math.PI*2); ctx.fill();
      }},
      {id:'astro', name:'Space Helmet', draw:(ctx)=>{
        ctx.strokeStyle='rgba(200,230,255,.7)'; ctx.lineWidth=12; ctx.beginPath(); ctx.ellipse(cx, cy-10, 300, 280, 0, 0, Math.PI*2); ctx.stroke();
        ctx.strokeStyle='rgba(200,230,255,.3)'; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(cx-160, cy-120); ctx.quadraticCurveTo(cx-40,cy-160,cx+80,cy-100); ctx.stroke();
      }},
    ];

    // ---------- STATE ----------
    const state = {
      seed: Math.floor(Math.random()*1e9),
      bg:0, body:1, eyes:0, mouth:0, acc:0,
      brand:true
    };

    // ---------- UI INIT ----------
    function fillSelect(el, items){
      el.innerHTML = items.map((x,i)=>`<option value="${i}">${x.name}</option>`).join('');
    }
    fillSelect($('#bg'), bgs);
    fillSelect($('#body'), bodyPalettes);
    fillSelect($('#eyes'), eyesList);
    fillSelect($('#mouth'), mouths);
    fillSelect($('#acc'), accs);

    // ---------- CANVAS ----------
    const canvas = $('#canvas');
    const ctx = canvas.getContext('2d');

    function draw(){
      // background
      bgs[state.bg].draw(ctx);

      // optional grid
      if($('#gridToggle').checked){
        ctx.strokeStyle='rgba(255,255,255,.06)'; ctx.lineWidth=1;
        for(let i=0;i<=size;i+=64){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,size);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(size,i);ctx.stroke();}
      }

      // deterministic RNG by seed for spots
      const rnd = rng(state.seed);

      // body
      drawBody(ctx, bodyPalettes[state.body].pal, rnd);

      // features
      eyesList[state.eyes].draw(ctx, bodyPalettes[state.body].pal);
      mouths[state.mouth].draw(ctx, bodyPalettes[state.body].pal);
      accs[state.acc].draw(ctx, bodyPalettes[state.body].pal);

      // footer label
      ctx.fillStyle='rgba(0,0,0,.35)'; ctx.fillRect(0,size-72,size,72);
      ctx.fillStyle='rgba(255,255,255,.9)'; ctx.font='28px ui-sans-serif,system-ui,Segoe UI,Roboto';
      ctx.fillText('Lamumu', 24, size-28);
      ctx.textAlign='right'; ctx.fillText(`#${String(state.seed).slice(-6)}`, size-24, size-28); ctx.textAlign='start';

      // optional brand badge
      if(state.brand){
        ctx.fillStyle='rgba(0,0,0,.55)';
        ctx.fillRect(size-240, 24, 200, 56);
        ctx.fillStyle='white';
        ctx.font='24px ui-sans-serif,system-ui,Segoe UI,Roboto';
        ctx.fillText('LAMUMU', size-230, 62);
      }

      // update UI id
      $('#mooId').textContent = `#LAMU-${fmt(String(state.seed).slice(-4))}`;
    }

    // ---------- EXPORT ----------
    function downloadURI(uri, name){
      const a = document.createElement('a'); a.href=uri; a.download=name; document.body.appendChild(a); a.click(); a.remove();
    }
    function savePNG(){
      downloadURI(canvas.toDataURL('image/png'), `lamumu_${state.seed}.png`);
    }
    function saveSVG(){
      const data = canvas.toDataURL('image/png');
      const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}">
        <image href="${data}" x="0" y="0" width="${size}" height="${size}" />
      </svg>`;
      const uri = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
      downloadURI(uri, `lamumu_${state.seed}.svg`);
    }

    // ---------- SHARE ----------
    function shareX(){
      const text = encodeURIComponent(`I just built my Lamumu cow! üêÑ #Lamumu
Seed: ${state.seed}`);
      const url = encodeURIComponent(location.href);
      const u = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
      window.open(u,'_blank');
    }

    // ---------- SEED / RANDOM ----------
    function randomize(all=true){
      state.seed = Math.floor(Math.random()*1e9);
      if(all){
        const r = rng(state.seed);
        state.bg = Math.floor(r()*bgs.length);
        state.body = Math.floor(r()*bodyPalettes.length);
        state.eyes = Math.floor(r()*eyesList.length);
        state.mouth = Math.floor(r()*mouths.length);
        state.acc = Math.floor(r()*accs.length);
        $('#bg').value = state.bg; $('#body').value=state.body; $('#eyes').value=state.eyes; $('#mouth').value=state.mouth; $('#acc').value=state.acc;
      }
      draw();
    }

    // ---------- EVENTS ----------
    $('#bg').addEventListener('change', e=>{state.bg=+e.target.value; draw();});
    $('#body').addEventListener('change', e=>{state.body=+e.target.value; draw();});
    $('#eyes').addEventListener('change', e=>{state.eyes=+e.target.value; draw();});
    $('#mouth').addEventListener('change', e=>{state.mouth=+e.target.value; draw();});
    $('#acc').addEventListener('change', e=>{state.acc=+e.target.value; draw();});
    $('#gridToggle').addEventListener('change', draw);
    $('#brandToggle').addEventListener('change', (e)=>{state.brand=e.target.checked; draw();});

    $('#random').addEventListener('click', ()=>randomize(true));
    $('#shuffleBody').addEventListener('click', ()=>{state.body=(state.body+1)%bodyPalettes.length; $('#body').value=state.body; draw();});
    $('#shuffleEyes').addEventListener('click', ()=>{state.eyes=(state.eyes+1)%eyesList.length; $('#eyes').value=state.eyes; draw();});
    $('#shuffleMouth').addEventListener('click', ()=>{state.mouth=(state.mouth+1)%mouths.length; $('#mouth').value=state.mouth; draw();});
    $('#shuffleAcc').addEventListener('click', ()=>{state.acc=(state.acc+1)%accs.length; $('#acc').value=state.acc; draw();});

    $('#savePng').addEventListener('click', savePNG);
    $('#saveSvg').addEventListener('click', saveSVG);
    $('#share').addEventListener('click', shareX);

    $('#copySeed').addEventListener('click', ()=>{
      const s = `${state.seed}:${state.bg},${state.body},${state.eyes},${state.mouth},${state.acc},${state.brand?1:0}`;
      navigator.clipboard.writeText(s); alert('Seed copied!');
    });
    $('#applySeed').addEventListener('click', ()=>{
      const v = $('#seedInput').value.trim();
      if(!v) return;
      const [seed, rest] = v.split(':');
      const parts = (rest||'').split(',').map(x=>+x);
      if(seed){ state.seed = +seed; }
      if(parts.length>=5 && parts.slice(0,5).every(x=>Number.isFinite(x))){
        [state.bg,state.body,state.eyes,state.mouth,state.acc] = parts.slice(0,5);
        state.brand = parts[5] ? true : false;
        $('#bg').value=state.bg; $('#body').value=state.body; $('#eyes').value=state.eyes; $('#mouth').value=state.mouth; $('#acc').value=state.acc; $('#brandToggle').checked = state.brand;
      }
      draw();
    });

    // INIT
    randomize(true);
  </script>
</body>
</html>
