<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lamumu Avatar Builder üêÑ</title>
<meta name="description" content="Build a Lamumu-style cow avatar. Randomize, export PNG/SVG, add the Lamumu logo, and share on X.">
<meta name="theme-color" content="#151515">
<style>
  :root{
    --bg:#0f1115;--panel:#161a23;--muted:#8892a6;--text:#e6edf6;--accent:#89d185;--line:#232838;
    --btn:#1f2533;--btn-h:#262d40;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 800px at 70% -20%, #1b2233 0%, var(--bg) 45%);
       color:var(--text);font:15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Arial;
       display:flex;align-items:center;justify-content:center;padding:24px}
  .app{width:100%;max-width:1150px;display:grid;grid-template-columns:1.25fr .75fr;gap:16px}
  @media(max-width:1000px){.app{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 30%),var(--panel);
        border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
  .stage{position:relative;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:16px;overflow:hidden}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:12px;border-top:1px solid var(--line);background:#131825}
  button,.select,input[type="text"]{appearance:none;border:1px solid var(--line);background:var(--btn);color:var(--text);
        padding:10px 12px;border-radius:10px;cursor:pointer}
  button:hover{background:var(--btn-h)}
  .select{display:flex;align-items:center;gap:8px}
  .select label{font-size:12px;color:var(--muted)}
  select{appearance:none;border:none;background:transparent;color:var(--text);font:inherit;padding:0 4px 0 0;min-width:130px;cursor:pointer}
  .side{padding:16px}
  h1{margin:0 0 6px;font-size:22px}
  .muted{color:var(--muted);margin:0 0 16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 0}
  .footer{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  .chip{font-size:12px;color:var(--muted)}
  .badge{display:inline-block;padding:3px 8px;border:1px dashed var(--line);border-radius:999px;color:var(--muted);font-size:12px}
  .credit{padding:10px 14px;border-top:1px dashed var(--line);color:var(--muted);font-size:12px}
  .switch{margin-left:auto;display:flex;align-items:center;gap:8px}
  .switch input{accent-color:var(--accent);width:36px;height:18px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .idtag{font-weight:700;color:#c0e5b9}
  .tiny{font-size:12px;color:var(--muted)}
  .stage-inner{width:90%;max-width:700px;aspect-ratio:1/1;border-radius:12px;overflow:hidden;border:1px solid var(--line);background:#0b0f19}
  canvas{display:block;width:100%;height:100%}
  input[type="file"]{border:none;background:transparent;color:var(--muted);padding:0}
</style>
</head>
<body>
<div class="app">
  <!-- Canvas -->
  <div class="card">
    <div class="stage">
      <div class="stage-inner">
        <canvas id="canvas" width="1024" height="1024"></canvas>
      </div>
    </div>
    <div class="toolbar">
      <div class="select"><label>Background</label><select id="bg"></select></div>
      <div class="select"><label>Body</label><select id="body"></select></div>
      <div class="select"><label>Eyes</label><select id="eyes"></select></div>
      <div class="select"><label>Mouth</label><select id="mouth"></select></div>
      <div class="select"><label>Accessory</label><select id="acc"></select></div>
      <div class="select"><label>Outline</label><select id="stroke"></select></div>
      <span class="switch"><label class="tiny">Grid</label><input id="gridToggle" type="checkbox"></span>
      <span class="switch"><label class="tiny">Lamumu badge</label><input id="brandToggle" type="checkbox" checked></span>
    </div>
  </div>

  <!-- Controls -->
  <div class="card side">
    <h1>Lamumu Avatar <span class="badge">MVP</span></h1>
    <p class="muted">Lamumu style, heavy outlines, cute proportions. ID: <span class="idtag" id="mooId">#LAMU-0001</span></p>

    <div class="grid">
      <div class="actions">
        <button id="random">üé≤ Random</button>
        <button id="shuffleBody">üé® Body</button>
        <button id="shuffleEyes">üëÄ Eyes</button>
        <button id="shuffleMouth">üëÑ Mouth</button>
        <button id="shuffleAcc">‚ú® Accessory</button>
      </div>
      <div class="actions">
        <button id="savePng">‚¨áÔ∏è PNG</button>
        <button id="saveSvg">‚¨áÔ∏è SVG</button>
        <button id="share">üí¨ Share</button>
      </div>
    </div>

    <div class="row">
      <span class="chip">Logo: <strong>upload</strong> or paste URL ‚Üí</span>
      <input type="file" id="logoFile" accept="image/*">
      <input type="text" id="logoUrl" placeholder="https://‚Ä¶/lamumu-logo.png" style="flex:1;min-width:200px">
      <button id="loadLogo">Load logo</button>
    </div>

    <div class="row">
      <span class="chip">Logo on:</span>
      <div class="select"><label>Position</label>
        <select id="logoPos">
          <option value="corner">Top-right badge</option>
          <option value="chest">Chest emblem</option>
        </select>
      </div>
      <div class="select"><label>Size</label>
        <select id="logoSize">
          <option value="S">S</option>
          <option value="M" selected>M</option>
          <option value="L">L</option>
        </select>
      </div>
      <button id="clearLogo">Clear</button>
    </div>

    <div class="footer">
      <button id="copySeed">üîë Copy seed</button>
      <button id="applySeed">üîÑ Apply seed</button>
      <input id="seedInput" class="select" placeholder="Paste seed" style="flex:1;min-width:200px;background:transparent;border:1px dashed var(--line);padding:10px;border-radius:10px;color:var(--text)">
    </div>

    <div class="credit">
      Built by <strong>Gutso</strong> ‚Ä¢ Ready for X: PNG/SVG export, #Lamumu share, logo overlay.<br>
      <span class="tiny">Tip: Post your PNG + seed. Mention the official account & hashtag.</span>
    </div>
  </div>
</div>

<script>
/* ---------- helpers ---------- */
const $ = s => document.querySelector(s);
const size = 1024, cx = size/2, cy = size/2;
const fmt = n => String(n).padStart(4,'0');
const rng = (seed)=>{let t=seed>>>0;return ()=>{t+=0x6D2B79F5;let r=Math.imul(t^t>>>15,1|t);r^=r+Math.imul(r^r>>>7,61|r);return((r^r>>>14)>>>0)/4294967296;}};
function downloadURI(uri,name){const a=document.createElement('a');a.href=uri;a.download=name;document.body.appendChild(a);a.click();a.remove();}

/* ---------- style palettes ---------- */
const P = {
  white:{base:'#fff7ef', spot:'#1b1b1b', nose:'#e7b6a0', ear:'#ffd8c4', horn:'#f0e2c1'},
  cocoa:{base:'#7b4b2e', spot:'#2c1b12', nose:'#d1a489', ear:'#e7b6a0', horn:'#e2d3ad'},
  night:{base:'#232631', spot:'#6e7ea6', nose:'#a8b3d6', ear:'#d3d9ff', horn:'#e2d3ad'},
  nebula:{base:'#efeaff', spot:'#7a5cff', nose:'#ff9bd7', ear:'#ffd7ef', horn:'#f0e2c1'}
};

/* ---------- backgrounds (Lamumu-ish scenes) ---------- */
const bgs = [
  {id:'plain', name:'Dark solid', draw:(ctx)=>{ctx.fillStyle='#0b0f19';ctx.fillRect(0,0,size,size);}},
  {id:'cabin', name:'Cabin', draw:(ctx)=>{ctx.fillStyle='#5a361e';ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#6b4125'; for(let i=0;i<size;i+=80){ctx.fillRect(0,i,size,40)}
    ctx.fillStyle='#0c1c2c'; ctx.fillRect(80,140,640,400); ctx.fillStyle='#1a9fff'; ctx.fillRect(90,150,620,380);
  }},
  {id:'jungle', name:'Jungle', draw:(ctx)=>{ctx.fillStyle='#1e2b1f';ctx.fillRect(0,0,size,size);
    function leaf(x,y,s){ctx.save();ctx.translate(x,y);ctx.scale(s,s);
      ctx.fillStyle='#1b3a2b';ctx.beginPath();ctx.moveTo(0,0);for(let i=0;i<6;i++){ctx.quadraticCurveTo(60,20,120,0);ctx.quadraticCurveTo(60,-20,0,0);}ctx.fill();ctx.restore();}
    for(let i=0;i<14;i++){leaf(Math.random()*size, 700+Math.random()*260, 2+Math.random()*2);}
  }},
  {id:'ocean', name:'Ocean', draw:(ctx)=>{ctx.fillStyle='#47a3ff';ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#1a82e2'; for(let y=680;y<=size;y+=40){ctx.beginPath();ctx.moveTo(0,y);for(let x=0;x<=size;x+=80){ctx.quadraticCurveTo(x+40,y-20,x+80,y);}ctx.lineTo(size,size);ctx.lineTo(0,size);ctx.fill();}
    ctx.fillStyle='#ffcd38'; ctx.beginPath(); ctx.arc(860,170,60,0,Math.PI*2); ctx.fill();
  }},
  {id:'meadow', name:'Meadow', draw:(ctx)=>{let sky=ctx.createLinearGradient(0,0,0,size);sky.addColorStop(0,'#bfe8ff');sky.addColorStop(1,'#dff5ff');ctx.fillStyle=sky;ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#7bd164'; ctx.beginPath(); ctx.ellipse(size/2, size*1.05, size*0.9, size*0.45, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='white'; for(let i=0;i<6;i++){ctx.beginPath();ctx.ellipse(120+i*160,160+Math.random()*40,90,36,0,0,Math.PI*2);ctx.fill();}
  }},
  {id:'arctic', name:'Arctic', draw:(ctx)=>{let g=ctx.createLinearGradient(0,0,0,size);g.addColorStop(0,'#cfe9ff');g.addColorStop(1,'#e9f6ff');ctx.fillStyle=g;ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#b9d9ef'; ctx.fillRect(0,700,size,324);
    ctx.fillStyle='#d5ecff'; ctx.beginPath(); ctx.moveTo(0,700); for(let x=0;x<=size;x+=80){ctx.quadraticCurveTo(x+40,680,x+80,700);} ctx.lineTo(size,size); ctx.lineTo(0,size); ctx.fill();
  }},
];

/* ---------- bodies ---------- */
// adds Lamumu Classic with grey face patch
const bodies = [
  {id:'lamu', name:'Lamumu Classic', pal:P.white, draw:(ctx, pal, rnd, stroke)=>{
    drawHeadBase(ctx, pal, stroke);
    // face patch (right eye)
    ctx.fillStyle='#9aa0a6';
    ctx.beginPath(); ctx.ellipse(cx+95, cy-20, 120, 130, -0.2, 0, Math.PI*2); ctx.fill();
    drawFaceDetails(ctx, pal, stroke, rnd, {spots:3}); // light spots on body
  }},
  {id:'holstein', name:'Holstein', pal:P.white, draw:(ctx, pal, rnd, stroke)=>{
    drawHeadBase(ctx, pal, stroke);
    drawFaceDetails(ctx, pal, stroke, rnd, {spots:7});
  }},
  {id:'cocoa', name:'Cocoa', pal:P.cocoa, draw:(ctx, pal, rnd, stroke)=>{
    drawHeadBase(ctx, pal, stroke);
    drawFaceDetails(ctx, pal, stroke, rnd, {spots:5});
  }},
  {id:'night', name:'Night', pal:P.night, draw:(ctx, pal, rnd, stroke)=>{
    drawHeadBase(ctx, pal, stroke);
    drawFaceDetails(ctx, pal, stroke, rnd, {spots:6});
  }},
  {id:'nebula', name:'Nebula', pal:P.nebula, draw:(ctx, pal, rnd, stroke)=>{
    drawHeadBase(ctx, pal, stroke);
    drawFaceDetails(ctx, pal, stroke, rnd, {spots:4});
  }},
];

function outline(ctx, f, stroke){
  ctx.save();
  ctx.lineWidth = stroke; ctx.strokeStyle = '#111'; ctx.lineJoin='round'; ctx.lineCap='round';
  f(); ctx.stroke(); ctx.restore();
}
function drawHeadBase(ctx, pal, stroke){
  ctx.fillStyle = pal.base;
  // head
  const head = ()=>{ctx.beginPath(); ctx.ellipse(cx, cy+40, 260, 220, 0, 0, Math.PI*2);};
  outline(ctx, head, stroke); head(); ctx.fill();
  // ears
  const le=()=>{ctx.beginPath(); ctx.ellipse(cx-220, cy-40, 70, 110, -0.2, 0, Math.PI*2);};
  const re=()=>{ctx.beginPath(); ctx.ellipse(cx+220, cy-40, 70, 110, 0.2, 0, Math.PI*2);};
  outline(ctx, le, stroke); le(); ctx.fill();
  outline(ctx, re, stroke); re(); ctx.fill();
  // horns
  ctx.fillStyle = P.white.horn;
  const lh=()=>{ctx.beginPath(); ctx.moveTo(cx-140, cy-160); ctx.quadraticCurveTo(cx-180,cy-250,cx-110,cy-220); ctx.quadraticCurveTo(cx-100,cy-190,cx-140,cy-160);};
  const rh=()=>{ctx.beginPath(); ctx.moveTo(cx+140, cy-160); ctx.quadraticCurveTo(cx+180,cy-250,cx+110,cy-220); ctx.quadraticCurveTo(cx+100,cy-190,cx+140,cy-160);};
  outline(ctx, lh, stroke); lh(); ctx.fill();
  outline(ctx, rh, stroke); rh(); ctx.fill();
}
function drawFaceDetails(ctx, pal, stroke, rnd, opts){
  // random spots on head
  ctx.fillStyle = pal.spot;
  const n = opts.spots||5;
  for(let i=0;i<n;i++){
    let x = cx + (rnd()*380-190);
    let y = cy + (rnd()*220-110);
    let rx = 26 + rnd()*82, ry = 22 + rnd()*70;
    ctx.save(); ctx.translate(x,y); ctx.rotate((rnd()-.5)*1.0);
    const sp = ()=>{ctx.beginPath(); ctx.ellipse(0,0,rx,ry,0,0,Math.PI*2);};
    outline(ctx, sp, stroke/2); sp(); ctx.globalAlpha=.9; ctx.fill(); ctx.restore();
  }
  // muzzle
  ctx.globalAlpha=1; ctx.fillStyle=pal.nose;
  const mz=()=>{ctx.beginPath(); ctx.ellipse(cx, cy+150, 180, 100, 0, 0, Math.PI*2);};
  outline(ctx, mz, stroke); mz(); ctx.fill();
  // nostrils
  ctx.fillStyle='rgba(0,0,0,.25)';
  const n1=()=>{ctx.beginPath(); ctx.ellipse(cx-45, cy+150, 16, 28, 0, 0, Math.PI*2);};
  const n2=()=>{ctx.beginPath(); ctx.ellipse(cx+45, cy+150, 16, 28, 0, 0, Math.PI*2);};
  outline(ctx, n1, stroke/2); n1(); ctx.fill();
  outline(ctx, n2, stroke/2); n2(); ctx.fill();
}

/* ---------- eyes / mouths / accessories ---------- */
const eyesList = [
  {id:'normal', name:'Normal', draw:(ctx)=>{
    const sock=(x,y)=>{ctx.fillStyle='#222'; const s=()=>{ctx.beginPath(); ctx.ellipse(x,y,50,36,0,0,Math.PI*2)}; outline(ctx,s,8); s(); ctx.fill();
      ctx.fillStyle='#fff'; ctx.beginPath(); ctx.ellipse(x,y,36,26,0,0,Math.PI*2); ctx.fill();
    };
    sock(cx-90,cy-30); sock(cx+90,cy-30);
    ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(cx-80, cy-30, 10, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cx+100, cy-28, 10, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(cx-76, cy-34, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cx+104, cy-32, 3, 0, Math.PI*2); ctx.fill();
  }},
  {id:'sleepy', name:'Sleepy', draw:(ctx)=>{
    ctx.strokeStyle='#111'; ctx.lineWidth=10; ctx.lineCap='round';
    ctx.beginPath(); ctx.moveTo(cx-120,cy-20); ctx.quadraticCurveTo(cx-90,cy-40,cx-60,cy-20); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(cx+60,cy-20); ctx.quadraticCurveTo(cx+90,cy-40,cx+120,cy-20); ctx.stroke();
  }},
  {id:'sunglasses', name:'Sunglasses', draw:(ctx)=>{
    const lens=(x)=>{ctx.fillStyle='#0e0e0e'; const f=()=>{ctx.beginPath(); ctx.ellipse(x, cy-30, 54, 38, 0, 0, Math.PI*2)}; outline(ctx,f,10); f(); ctx.fill();};
    lens(cx-90); lens(cx+90); ctx.strokeStyle='#333'; ctx.lineWidth=10; ctx.beginPath(); ctx.moveTo(cx-36,cy-28); ctx.lineTo(cx+36,cy-28); ctx.stroke();
  }},
  {id:'laser', name:'Laser', draw:(ctx)=>{
    ctx.fillStyle='#fff'; ['-90','+90'].map(dx=>+dx).forEach(dx=>{const f=()=>{ctx.beginPath();ctx.ellipse(cx+dx,cy-30,28,22,0,0,Math.PI*2)}; outline(ctx,f,8); f(); ctx.fill();});
    ctx.fillStyle='#ff0040'; ctx.beginPath(); ctx.arc(cx-90, cy-30, 7, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cx+90, cy-30, 7, 0, Math.PI*2); ctx.fill();
    const g=ctx.createLinearGradient(cx-90,cy-30, 0, size); g.addColorStop(0,'rgba(255,0,64,.9)'); g.addColorStop(1,'rgba(255,0,64,0)');
    ctx.fillStyle=g; ctx.globalAlpha=.7; ctx.fillRect(0, cy-20, size, 8); ctx.globalAlpha=1;
  }},
  {id:'hearts', name:'Hearts', draw:(ctx)=>{
    ctx.fillStyle='#ff4d6d';
    function heart(x,y,s){ctx.save();ctx.translate(x,y);ctx.scale(s,s);const f=()=>{ctx.beginPath();ctx.moveTo(0,-10);ctx.bezierCurveTo(12,-24,30,-6,0,20);ctx.bezierCurveTo(-30,-6,-12,-24,0,-10)}; outline(ctx,f,6); f(); ctx.fill(); ctx.restore();}
    heart(cx-90,cy-30,1.2); heart(cx+90,cy-30,1.2);
  }},
];

const mouths = [
  {id:'smile', name:'Smile', draw:(ctx)=>{ctx.strokeStyle='#3a1a10'; ctx.lineWidth=10; ctx.lineCap='round'; ctx.beginPath(); ctx.arc(cx, cy+130, 46, 0, Math.PI); ctx.stroke();}},
  {id:'tongue', name:'Tongue out', draw:(ctx)=>{ctx.strokeStyle='#3a1a10'; ctx.lineWidth=10; ctx.lineCap='round'; ctx.beginPath(); ctx.moveTo(cx-40,cy+135); ctx.quadraticCurveTo(cx,cy+165,cx+40,cy+135); ctx.stroke(); ctx.fillStyle='#ff6b9a'; ctx.beginPath(); ctx.ellipse(cx, cy+150, 22, 16, 0, 0, Math.PI*2); ctx.fill();}},
  {id:'open', name:'Open mouth', draw:(ctx)=>{const f=()=>{ctx.beginPath(); ctx.ellipse(cx, cy+140, 32, 26, 0, 0, Math.PI*2)}; outline(ctx,f,8); f(); ctx.fillStyle='#2a1710'; ctx.fill(); ctx.fillStyle='#ffb3c1'; ctx.beginPath(); ctx.ellipse(cx, cy+152, 18, 12, 0, 0, Math.PI*2); ctx.fill();}},
  {id:'vibe', name:'Vibe', draw:(ctx)=>{ctx.strokeStyle='#3a1a10'; ctx.lineWidth=10; ctx.lineCap='round'; ctx.beginPath(); ctx.moveTo(cx-50,cy+130); ctx.lineTo(cx-10,cy+145); ctx.lineTo(cx+30,cy+125); ctx.lineTo(cx+50,cy+135); ctx.stroke();}},
  {id:'whistle', name:'Whistle', draw:(ctx)=>{ctx.strokeStyle='#3a1a10'; ctx.lineWidth=10; ctx.lineCap='round'; ctx.beginPath(); ctx.arc(cx, cy+140, 18, Math.PI*.1, Math.PI*.9); ctx.stroke();}},
];

const accs = [
  {id:'none', name:'None', draw:()=>{}},
  {id:'cap', name:'Cap', draw:(ctx)=>{const f=()=>{ctx.beginPath(); ctx.ellipse(cx, cy-170, 160, 70, 0.02, 0, Math.PI*2)}; outline(ctx,f,8); f(); ctx.fillStyle='#2b6cf0'; ctx.fill();
    const br=()=>{ctx.beginPath(); ctx.ellipse(cx+60, cy-140, 120, 34, 0.02, 0, Math.PI*2)}; outline(ctx,br,8); br(); ctx.fillStyle='#244db3'; ctx.fill();}},
  {id:'ring', name:'Earrings', draw:(ctx)=>{ctx.strokeStyle='#ffd400'; ctx.lineWidth=10; ctx.beginPath(); ctx.arc(cx-220, cy+10, 18, 0, Math.PI*2); ctx.stroke(); ctx.beginPath(); ctx.arc(cx+220, cy+10, 18, 0, Math.PI*2); ctx.stroke();}},
  {id:'bell', name:'Bell', draw:(ctx)=>{const f=()=>{ctx.beginPath(); ctx.ellipse(cx, cy+220, 36, 30, 0, 0, Math.PI*2)}; outline(ctx,f,8); f(); ctx.fillStyle='#ffcf33'; ctx.fill(); ctx.fillStyle='#c08a00'; ctx.beginPath(); ctx.arc(cx, cy+236, 10, 0, Math.PI*2); ctx.fill();}},
  {id:'astro', name:'Space Helmet', draw:(ctx)=>{ctx.strokeStyle='rgba(200,230,255,.7)'; ctx.lineWidth=14; ctx.beginPath(); ctx.ellipse(cx, cy-10, 300, 280, 0, 0, Math.PI*2); ctx.stroke();}},
];

/* ---------- UI state ---------- */
const canvas = $('#canvas'); const ctx = canvas.getContext('2d');
const strokeOptions = [{name:'Thin', v:6},{name:'Medium', v:10},{name:'Thick', v:14}];
const state = {seed:Math.floor(Math.random()*1e9), bg:0, body:0, eyes:0, mouth:0, acc:0, brand:true, stroke:1, logo:null, logoPos:'corner', logoSize:'M'};

/* ---------- selects ---------- */
function fillSelect(el, items, name='name'){ el.innerHTML = items.map((x,i)=>`<option value="${i}">${x[name]||x}</option>`).join(''); }
fillSelect($('#bg'), bgs);
fillSelect($('#body'), bodies);
fillSelect($('#eyes'), eyesList);
fillSelect($('#mouth'), mouths);
fillSelect($('#acc'), accs);
fillSelect($('#stroke'), strokeOptions);

['bg','body','eyes','mouth','acc','stroke'].forEach(id => $(`#${id}`).addEventListener('change', e=>{ state[id] = +e.target.value; draw(); }));
$('#gridToggle').addEventListener('change', draw);
$('#brandToggle').addEventListener('change', e=>{state.brand=e.target.checked; draw();});

/* ---------- logo load ---------- */
$('#loadLogo').addEventListener('click', ()=>{
  const url = $('#logoUrl').value.trim();
  if(url){ const img=new Image(); img.crossOrigin='anonymous'; img.onload=()=>{state.logo=img; draw();}; img.src=url; }
});
$('#logoFile').addEventListener('change', (e)=>{
  const f=e.target.files[0]; if(!f) return;
  const reader=new FileReader(); reader.onload=()=>{ const img=new Image(); img.onload=()=>{state.logo=img; draw();}; img.src=reader.result; };
  reader.readAsDataURL(f);
});
$('#clearLogo').addEventListener('click', ()=>{state.logo=null; draw();});
$('#logoPos').addEventListener('change', e=>{state.logoPos=e.target.value; draw();});
$('#logoSize').addEventListener('change', e=>{state.logoSize=e.target.value; draw();});

/* ---------- drawing ---------- */
function draw(){
  // BG
  bgs[state.bg].draw(ctx);

  // optional grid
  if($('#gridToggle').checked){
    ctx.strokeStyle='rgba(255,255,255,.06)'; ctx.lineWidth=1;
    for(let i=0;i<=size;i+=64){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,size);ctx.stroke();
                               ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(size,i);ctx.stroke();}
  }

  const rnd = rng(state.seed); const stroke = strokeOptions[state.stroke].v;
  // body (with patch + outline)
  bodies[state.body].draw(ctx, bodies[state.body].pal, rnd, stroke);

  // features
  eyesList[state.eyes].draw(ctx);
  mouths[state.mouth].draw(ctx);
  accs[state.acc].draw(ctx);

  // Lamumu text strip
  ctx.fillStyle='rgba(0,0,0,.35)'; ctx.fillRect(0,size-72,size,72);
  ctx.fillStyle='rgba(255,255,255,.92)'; ctx.font='28px ui-sans-serif,system-ui,Segoe UI,Roboto';
  ctx.fillText('Lamumu', 24, size-28);
  ctx.textAlign='right'; ctx.fillText(`#${String(state.seed).slice(-6)}`, size-24, size-28); ctx.textAlign='start';

  // Brand badge (toggle)
  if(state.brand){
    ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(size-240, 24, 200, 56);
    ctx.fillStyle='white'; ctx.font='24px ui-sans-serif,system-ui,Segoe UI,Roboto';
    ctx.fillText('LAMUMU', size-230, 62);
  }

  // Logo overlay (uploaded/URL)
  if(state.logo){
    const s = state.logoSize==='S'? 90 : state.logoSize==='L'? 180 : 130;
    if(state.logoPos==='corner'){
      ctx.drawImage(state.logo, size-24-s, 24, s, s);
    }else{
      // chest emblem
      ctx.save(); ctx.beginPath(); ctx.ellipse(cx, cy+210, 120, 90, 0, 0, Math.PI*2); ctx.clip();
      ctx.drawImage(state.logo, cx-60, cy+150, 120, 120);
      ctx.restore();
    }
  }

  // update UI id
  $('#mooId').textContent = `#LAMU-${fmt(String(state.seed).slice(-4))}`;
}

/* ---------- export/share ---------- */
function savePNG(){ downloadURI(canvas.toDataURL('image/png'), `lamumu_${state.seed}.png`); }
function saveSVG(){ const data=canvas.toDataURL('image/png'); const svg=`<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}"><image href="${data}" x="0" y="0" width="${size}" height="${size}" /></svg>`; downloadURI('data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svg), `lamumu_${state.seed}.svg`); }
function shareX(){ const text=encodeURIComponent(`I just built my Lamumu cow! üêÑ #Lamumu\nSeed: ${state.seed}`); const url=encodeURIComponent(location.href); window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`,'_blank'); }

/* ---------- seed & random ---------- */
function randomize(all=true){
  state.seed = Math.floor(Math.random()*1e9);
  if(all){
    const r = rng(state.seed);
    state.bg = Math.floor(r()*bgs.length);
    state.body = Math.floor(r()*bodies.length);
    state.eyes = Math.floor(r()*eyesList.length);
    state.mouth = Math.floor(r()*mouths.length);
    state.acc = Math.floor(r()*accs.length);
    ['bg','body','eyes','mouth','acc'].forEach(id => $(`#${id}`).value = state[id]);
  }
  draw();
}

/* ---------- events ---------- */
$('#random').addEventListener('click', ()=>randomize(true));
$('#shuffleBody').addEventListener('click', ()=>{state.body=(state.body+1)%bodies.length; $('#body').value=state.body; draw();});
$('#shuffleEyes').addEventListener('click', ()=>{state.eyes=(state.eyes+1)%eyesList.length; $('#eyes').value=state.eyes; draw();});
$('#shuffleMouth').addEventListener('click', ()=>{state.mouth=(state.mouth+1)%mouths.length; $('#mouth').value=state.mouth; draw();});
$('#shuffleAcc').addEventListener('click', ()=>{state.acc=(state.acc+1)%accs.length; $('#acc').value=state.acc; draw();});

$('#savePng').addEventListener('click', savePNG);
$('#saveSvg').addEventListener('click', saveSVG);
$('#share').addEventListener('click', shareX);

$('#copySeed').addEventListener('click', ()=>{
  const s = `${state.seed}:${state.bg},${state.body},${state.eyes},${state.mouth},${state.acc},${state.brand?1:0},${state.stroke}`;
  navigator.clipboard.writeText(s); alert('Seed copied!');
});
$('#applySeed').addEventListener('click', ()=>{
  const v = $('#seedInput').value.trim(); if(!v) return;
  const [seed, rest] = v.split(':'); const parts=(rest||'').split(',').map(x=>+x);
  if(seed){ state.seed=+seed; }
  if(parts.length>=6){
    [state.bg,state.body,state.eyes,state.mouth,state.acc] = parts.slice(0,5);
    state.brand = !!parts[5]; state.stroke = parts[6] ?? state.stroke;
    ['bg','body','eyes','mouth','acc','stroke'].forEach(id => $(`#${id}`).value = state[id]);
    $('#brandToggle').checked = state.brand;
  }
  draw();
});

/* ---------- init ---------- */
randomize(true);
</script>
</body>
</html>
